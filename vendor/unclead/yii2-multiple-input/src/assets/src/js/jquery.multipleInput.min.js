!function(t){"use strict";t.fn.multipleInput=function(e){return r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.multipleInput"),!1):r.init.apply(this,arguments)};var e={afterInit:"afterInit",beforeAddRow:"beforeAddRow",afterAddRow:"afterAddRow",beforeDeleteRow:"beforeDeleteRow",afterDeleteRow:"afterDeleteRow",afterDropRow:"afterDropRow"},n={id:null,inputId:null,template:null,jsTemplates:[],jsInit:[],max:1,min:1,attributes:{},indexPlaceholder:"multiple_index",showGeneralError:!1,prepend:!1},i=!1,r={init:function(r){if("object"!=typeof r)return void console.error("Options must be an object");var u=t.extend(!0,{},n,r||{}),s=t("#"+u.id),f=s.closest("form"),c=u.inputId;for(v in u.jsInit)window.eval(u.jsInit[v]);s.data("multipleInput",{settings:u,currentIndex:0}),s.on("click.multipleInput",".js-input-remove",function(e){e.stopPropagation(),l(t(this))}),s.on("click.multipleInput",".js-input-plus",function(e){e.stopPropagation(),a(t(this))}),s.on("click.multipleInput",".js-input-clone",function(e){e.stopPropagation(),a(t(this),d(t(this)))});var v=0,m=t.Event(e.afterInit),h=setInterval(function(){if("object"==typeof f.data("yiiActiveForm")){var e=f.yiiActiveForm("find",c),n={enableAjaxValidation:!1,validateOnBlur:!1,validateOnChange:!1,validateOnType:!1,validationDelay:500};"object"==typeof e&&(t.each(e,function(t,e){["id","input","container"].indexOf(t)===-1&&(n[t]=e)}),u.showGeneralError||f.yiiActiveForm("remove",c)),t.each(u.attributes,function(e,i){i=t.extend({},n,i),u.attributes[e]=i}),s.data("multipleInput").settings=u,s.find(".multiple-input-list").find("input, select, textarea").each(function(){o(t(this))}),s.data("multipleInput").currentIndex=p(s),i=!0,clearInterval(h),s.trigger(m)}else v++;(0===f.length||v>10)&&(s.data("multipleInput").currentIndex=p(s),i=!1,clearInterval(h),s.trigger(m))},100)},add:function(e){a(t(this),e)},remove:function(e){var n=null;n=void 0!==e?t(this).find(".js-input-remove:eq("+e+")"):t(this).find(".js-input-remove").last(),l(n)},clear:function(){t(this).find(".js-input-remove").each(function(){l(t(this))})},option:function(e,n){n=n||null;var i=t(this).data("multipleInput"),r=i.settings;if(null===n){if(!r.hasOwnProperty(e))throw new Error('Option "'+e+'" does not exist');return r[e]}r.hasOwnProperty(e)&&(r[e]=n,i.settings=r,t(this).data("multipleInput",i))}},a=function(n,r){var a=t(n).closest(".multiple-input").first(),l=a.data("multipleInput"),u=l.settings,d=u.template,c=a.children(".multiple-input-list").first();if(!(null!==u.max&&p(a)>=u.max)){d=f("{"+u.indexPlaceholder+"}",l.currentIndex,d);var v=t(d),m=l.currentIndex,h=t.Event(e.beforeAddRow);if(a.trigger(h,[v,m]),h.result!==!1){if(u.prepend?v.hide().prependTo(c).fadeIn(300):v.hide().appendTo(c).fadeIn(300),r instanceof Object){var I=[];for(var g in r)r.hasOwnProperty(g)&&I.push(r[g]);r=I}var w;for(var x in u.jsTemplates)w=u.jsTemplates[x],w=f("{"+u.indexPlaceholder+"}",l.currentIndex,w),w=f("%7B"+u.indexPlaceholder+"%7D",l.currentIndex,w),window.eval(w);var y=0;t(d).find("input, select, textarea").each(function(e,n){var a=t(n),l=n.tagName,u=s(a),p=t("#"+u);if(r){var d=r[y];if("INPUT"===l||"TEXTAREA"===l)p.val(d);else if("SELECT"===l)if(d&&d.indexOf("option")!==-1)p.append(d);else{var f=p.find('option[value="'+d+'"]');f.length&&p.val(d)}}i&&o(a),y++}),a.data("multipleInput").currentIndex++;var j=t.Event(e.afterAddRow);a.trigger(j,[v,m])}}},l=function(n){var r=n.closest(".multiple-input").first(),a=n.closest(".multiple-input-list__item"),l=r.data("multipleInput"),o=l.settings,s=p(r);if(s>o.min){var d=t.Event(e.beforeDeleteRow);if(r.trigger(d,[a,s]),d.result===!1)return;i&&a.find("input, select, textarea").each(function(e,n){u(t(n))}),a.fadeOut(300,function(){t(this).remove(),d=t.Event(e.afterDeleteRow),r.trigger(d,[a,s])})}},o=function(e){var n=s(e);if(null!==n){var i=t("#"+n),r=i.closest(".multiple-input").first(),a=i.closest("form");if(0!==r.length&&"undefined"==typeof a.yiiActiveForm("find",n)){var l=r.data("multipleInput"),o={},u=n.replace(/-\d+-([^\d]+)$/,"-$1");l.settings.attributes.hasOwnProperty(u)?o=l.settings.attributes[u]:(u=f(/-\d-/,"-",u),u=f(/-\d/,"",u),l.settings.attributes.hasOwnProperty(u)&&(o=l.settings.attributes[u])),a.yiiActiveForm("add",t.extend({},o,{id:n,input:"#"+n,container:".field-"+n}))}}},u=function(e){var n=s(e);if(null!==n){var i=t("#"+n).closest("form");0!==i.length&&i.yiiActiveForm("remove",n)}},s=function(t){var e=t.attr("id");return"undefined"==typeof e&&(e=t.data("id")),"undefined"==typeof e?null:e},p=function(e){return e.find(".multiple-input-list .multiple-input-list__item").filter(function(){return t(this).parents(".multiple-input").first().attr("id")===e.attr("id")}).length},d=function(e){var n={};return e.closest("tr").find("td").each(function(e,i){t(i).find("input, select, textarea").each(function(e,i){var r=t(i),a=s(r),l=t("#"+a);n[a]=l.val()})}),n},f=function(t,e,n){return n instanceof String||"string"==typeof n?n.split(t).join(e):(console.warn("Call replaceAll for non-string value: "+n),n)}}(window.jQuery);